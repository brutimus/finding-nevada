<!DOCTYPE html>
<html>
<head>
  <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />
  <script src='ext/js/mapbox-1.3.1.js'></script>
  <script type="text/javascript" src="ext/js/jquery-1.9.1.min.js"></script>
  <script type="text/javascript" src="ext/js/waypoints.min.js"></script>
  <script type="text/javascript" src="ext/js/waypoints-sticky.min.js"></script>
  <script type="text/javascript" src="ext/js/jquery.colorbox-min.js"></script>
  <link href='ext/css/mapbox-1.3.1.css' rel='stylesheet' />
  <link rel="stylesheet" href="ext/css/colorbox.css" type="text/css" media="screen" />
  <!-- <link rel="stylesheet" href="ext/css/colorbox-1.0.0.css" type="text/css" media="screen" /> -->
  <!--[if lte IE 8]>
    <link href='http://api.tiles.mapbox.com/mapbox.js/v1.3.1/mapbox.ie.css' rel='stylesheet' >
  <![endif]-->

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="ext/bootstrap/css/bootstrap.css">

	<!-- Latest compiled and minified JavaScript -->
	<script src="ext/bootstrap/js/bootstrap.js"></script>

  <style>
    body { margin:0; padding:0; height: 100%; width: 100%; bottom: 0px; position: absolute;}
    h2 {
    	margin-top: 0;
    }
    #masthead {
    	background: #ffc100; /* Old browsers */
		background: -moz-linear-gradient(top, #ffc100 0%, #ff9900 100%); /* FF3.6+ */
		background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#ffc100), color-stop(100%,#ff9900)); /* Chrome,Safari4+ */
		background: -webkit-linear-gradient(top, #ffc100 0%,#ff9900 100%); /* Chrome10+,Safari5.1+ */
		background: -o-linear-gradient(top, #ffc100 0%,#ff9900 100%); /* Opera 11.10+ */
		background: -ms-linear-gradient(top, #ffc100 0%,#ff9900 100%); /* IE10+ */
		background: linear-gradient(to bottom, #ffc100 0%,#ff9900 100%); /* W3C */
		filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#ffc100', endColorstr='#ff9900',GradientType=0 ); /* IE6-9 */
    }
    .navbar-brand {
    	padding: 0;
    }
    .navbar-brand img {
    	height: 50px;
    }
    #storyList h2.stuck {
    	position: fixed;
    	display: none;
		background: #eee;
		width: 200px;
		margin: 0;
		padding: 0;
		top: 302px;
		padding: 5px;
		border: 2px solid #666;
		border-radius: 0 5px 5px 0;
		font-size: 24px;
		line-height: 24px;
    }
    .jumbotron {
    	margin: 0;
    	padding: 0;
    }
    #map, #mapContainer {
    	background-color: white;
    	height: 300px;
    	padding: 0;
    	z-index: 100;
    }
    #mapContainer.stuck {
    	position: fixed;
    	top: 0;
    }
    .my-div-icon {
    	width: 10px;
    	height: 10px;
    	border-radius: 100%;
    	background-color: #990000;
    	box-shadow: 1px 1px 2px #666;
    }
  </style>
</head>
<body>
	<div class="container">
		<!-- <div id="masthead" class="condensed">
			<img src="http://media.lasvegassun.com/media/assets/images/global/mini-masthead.png">
		</div> -->
		<nav class="navbar navbar-default" role="navigation">
		  <!-- Brand and toggle get grouped for better mobile display -->
		  <div class="navbar-header">
		    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
		      <span class="sr-only">Toggle navigation</span>
		      <span class="icon-bar"></span>
		      <span class="icon-bar"></span>
		      <span class="icon-bar"></span>
		    </button>
		    <a class="navbar-brand" href="#"><img src="http://media.lasvegassun.com/media/assets/images/global/interior_logo.png"></a>
		  </div>

		  <!-- Collect the nav links, forms, and other content for toggling -->
		  <div class="collapse navbar-collapse navbar-ex1-collapse">
		    <ul class="nav navbar-nav">
		      <li class="active"><a href="#">Nevada Heartland</a></li>
		      <li><a href="#">Kit Carson Trail</a></li>
		      <li><a href="#">Viva Las Vegas</a></li>
		      <li><a href="#">Pony Express</a></li>
		      <li><a href="#">Emigrant Trail</a></li>
		    </ul>
		  </div><!-- /.navbar-collapse -->
		</nav>
		<div id="mapContainer" class="jumbotron">
			<div id='map'></div>
		</div>
		<section id="storyList" class="col-xs-12 col-md-8">
			<article id="dayOne">
				<h2>Day 1</h2>
				<span lat="36.20" lng="-114.98">
					<h3 storyID="foo"><a href="ajax_sample.html">Title</a></h3>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
					tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
					quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
					consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
					cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
					proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
				</span>
				<span lat="36.43" lng="-114.420">
					<h3>Title</h3>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
					tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
					quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
					consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
					cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
					proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
				</span>
				<span lat="36.73" lng="-114.70">
					<h3>Title</h3>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
					tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
					quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
					consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
					cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
					proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
				</span>
				<span lat="37.09" lng="-114.96">
					<h3>Title</h3>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
					tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
					quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
					consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
					cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
					proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
				</span>
		<!-- 			<span lat="37.55" lng="-115.22">
					<h3>Title</h3>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
					tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
					quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
					consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
					cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
					proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
				</span> -->
			</article>
			<article id="dayTwo">
				<h2>Day 2</h2>
				<span lat="37.57" lng="-115.62">
					<h3>Title</h3>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
					tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
					quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
					consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
					cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
					proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
				</span>
				<span lat="37.79" lng="-115.96">
					<h3>Title</h3>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
					tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
					quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
					consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
					cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
					proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
				</span>
				<span lat="38.23" lng="-116.18">
					<h3>Title</h3>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
					tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
					quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
					consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
					cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
					proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
				</span>
				<span lat="38.72" lng="-116.18">
					<h3>Title</h3>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
					tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
					quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
					consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
					cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
					proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
				</span>
				<span lat="38.09" lng="-117.07">
					<h3>Title</h3>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
					tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
					quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
					consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
					cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
					proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
				</span>
			</article>
			<article id="dayThree">
				<h2>Day 3</h2>
				<span>
					<h3>Title</h3>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
					tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
					quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
					consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
					cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
					proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
				</span>
				<span>
					<h3>Title</h3>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
					tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
					quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
					consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
					cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
					proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
				</span>
				<span>
					<h3>Title</h3>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
					tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
					quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
					consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
					cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
					proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
				</span>
				<span>
					<h3>Title</h3>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
					tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
					quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
					consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
					cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
					proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
				</span>
				<span>
					<h3>Title</h3>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
					tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
					quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
					consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
					cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
					proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
				</span>
			</article>
			<article id="dayFour">
				<h2>Day 4</h2>
				<span>
					<h3>Title</h3>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
					tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
					quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
					consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
					cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
					proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
				</span>
				<span>
					<h3>Title</h3>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
					tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
					quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
					consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
					cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
					proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
				</span>
				<span>
					<h3>Title</h3>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
					tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
					quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
					consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
					cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
					proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
				</span>
				<span>
					<h3>Title</h3>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
					tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
					quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
					consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
					cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
					proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
				</span>
				<span>
					<h3>Title</h3>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
					tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
					quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
					consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
					cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
					proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
				</span>
			</article>
			<article id="dayFive">
				<h2>Day 5</h2>
				<span>
					<h3>Title</h3>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
					tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
					quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
					consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
					cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
					proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
				</span>
				<span>
					<h3>Title</h3>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
					tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
					quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
					consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
					cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
					proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
				</span>
				<span>
					<h3>Title</h3>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
					tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
					quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
					consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
					cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
					proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
				</span>
				<span>
					<h3>Title</h3>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
					tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
					quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
					consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
					cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
					proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
				</span>
				<span>
					<h3>Title</h3>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
					tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
					quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
					consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
					cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
					proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
				</span>
			</article>
		</section>
	</div>



<script type='text/javascript'>

var mapLock = 0,
	scrollLock = false;

function panMapTo (dayDiv) {
	var lats = [],
		lngs = [];
	$('span', dayDiv).each(function(i, v){
		var lat = parseFloat(v.getAttribute('lat')),
			lng = parseFloat(v.getAttribute('lng'));
		lats.push(lat);
		lngs.push(lng);
	})
	var sw = [Math.min.apply(Math, lats), Math.min.apply(Math, lngs)];
	var ne = [Math.max.apply(Math, lats), Math.max.apply(Math, lngs)];
	if ($.isNumeric(sw[0]) && $.isNumeric(sw[1]) &&
		$.isNumeric(ne[0]) && $.isNumeric(ne[1])) {
		map.fitBounds([sw, ne], {animate: true});
	}
}

var layers = {
	'one': {
		'sw': [35.84, -117.50],
		'ne': [38.77, -114.17],
		'obj': null,
		'layerName': 'red'
	},
	'two': {
		'sw': [35.98, -119.82],
		'ne': [41.13, -114.24],
		'obj': null,
		'layerName': 'green'
	},
	'three': {
		'sw': [35.041, -115.60],
		'ne': [36.483, -114.36],
		'obj': null,
		'layerName': 'purple'
	},
	'four': {
		'sw': [35.84, -117.50],
		'ne': [39.64, -114.22],
		'obj': null,
		'layerName': 'blue'
	},
	'five': {
		'sw': [35.98, -119.82],
		'ne': [41.97, -113.91],
		'obj': null,
		'layerName': 'orange'
	}, 
};

// var markerJSON = {
// 	type: 'Feature',
// 	geometry: {
// 		type:'Point',
// 		coordinates: ''
// 	}
// }


// Initialize map
var map = L.mapbox.map(
	'map',
	'gmgcoders.map-s5kpz88c',
	{scrollWheelZoom: false}
).on(
	'movestart',
	function(){mapLock++;}
).on(
	'moveend',
	function(){mapLock--;}
);

// Initialize helpers
var icon = L.mapbox.marker.icon({
	'marker-size': 'small',
	'marker-color': '#48a',
	'marker-symbol': 'parking'
});

var myIcon = L.divIcon({className: 'my-div-icon'});

// Initialize lightboxes
$('h3').each(function(i, v){
	if (v.hasAttribute('storyID')) {
		$(v).find('a').colorbox({
			// inline:true,
			// href:"#" + v.getAttribute('storyID'),
			width: '90%',
			height: '90%'
		});
	};
})

// Initialize layers
L.mapbox.tileLayer('gmgcoders.shade').addTo(map);
$.each(layers, function(name, val) {
	layers[name]['obj'] = L.mapbox.tileLayer('gmgcoders.' + val['layerName']);
});
(l = layers['one'])['obj'].addTo(map);
map.fitBounds([l['sw'], l['ne']]);

// Parse data & place pins
$('#storyList span').each(function(i, v){
	var lat = parseFloat(v.getAttribute('lat')),
		lng = parseFloat(v.getAttribute('lng'));
	if (lat && lng)	L.marker([lat, lng], {icon: myIcon}).addTo(map).on('click', function(e){
		var dayDiv = $(v).parents("[id^='day']");
		if (!mapLock) {mapLock++; panMapTo(dayDiv);};
		$('body').animate({
			scrollTop: $(v).position().top + 30
		}, duration=500, complete=function(){mapLock--});
	}.bind());
});

// Setup waypoints
$('#mapContainer').waypoint('sticky');
$('#storyList article').each(function(i, v){
	$(v).waypoint(function(){
		if (!mapLock) {mapLock++; panMapTo(v); mapLock--;};
	}, {
		// context: '#storyListContainer',
		offset: '300px'
	});
});
$('#storyList article h2').waypoint('sticky', {
	// context: '#storyListContainer',
	offset: '300px'
});

</script>
</body>
</html>